<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f1f3ff; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    }
    .card {
      border: none; 
      border-radius: 12px; 
    }
    .btn-primary {
      background: linear-gradient(to right, #5e17eb, #7b3ff2);
      border: none; 
    }
    .form-control:focus {
      box-shadow: none; 
      border-color: #7b3ff2; 
    }
    .form-label {
      font-weight: 500; 
    }
    .eye-icon {
      cursor: pointer; 
    }
  </style>
</head>
<body>
  <div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow p-4">
        <h3 class="text-center text-primary fw-bold mb-2">Employee Login</h3>
        <p class="text-center text-muted">Sign in to access your dashboard</p>

        <form id="loginForm">
          <div class="mb-3">
            <label for="loginEmail" class="form-label">Email</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-envelope"></i></span>
              <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required autocomplete="off" />
            </div>
          </div>

          <div class="mb-3">
            <label for="loginPassword" class="form-label">Password</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-lock"></i></span>
              <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required autocomplete="off"/>
              <span class="input-group-text eye-icon" onclick="togglePassword()"><i class="bi bi-eye" id="toggleIcon"></i></span>
            </div>
            <div class="text-end mt-1">
              <a href="#" onclick="forgotPassword()" class="text-decoration-none">Forgot password?</a>
            </div>
          </div>

          <div id="loginError" class="text-danger mb-3"></div>

          <button type="submit" class="btn btn-primary w-100"><i class="bi bi-box-arrow-in-right me-2"></i>Sign In</button>

          <div class="text-center mt-3">
            Don't have an account? <a href="registration.html" class="text-decoration-none">Create account</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // admin credential
    const ADMIN_EMAIL = "joice123@gmail.com";
    const ADMIN_PASSWORD = "joice@123";
    const ADMIN_USERNAME = "Joice";

    // Get the login form element
    const loginForm = document.getElementById("loginForm");
    const loginErrorDisplay = document.getElementById("loginError");

    loginForm.addEventListener("submit", function (event) {
    event.preventDefault();  // Prevent the browser's default action

      // Get the email and password entered by the user
      const enteredEmail = document.getElementById("loginEmail").value.trim();
      const enteredPassword = document.getElementById("loginPassword").value; 

      loginErrorDisplay.textContent = "";    // Clear any previous error messages

      // --- Admin Login Check  If it's the admin, save admin info to local storage
      if (enteredEmail === ADMIN_EMAIL && enteredPassword === ADMIN_PASSWORD) {
        localStorage.setItem("currentUser", JSON.stringify({
          username: ADMIN_USERNAME,
          email: ADMIN_EMAIL,
          role: "admin"
        }));
        location.href = "admin.html";  // redirect to the admin dashboard page and stop next function process
        return; 
      }

      // --- User Login Check (from local storage)
      const allRegisteredUsers = JSON.parse(localStorage.getItem("users")) || [];

      // matching user mail and password
      const foundUser = allRegisteredUsers.find(user =>
        user.email === enteredEmail && user.password === enteredPassword
      );

      if (foundUser) {
        localStorage.setItem("currentUser", JSON.stringify(foundUser));

        if (foundUser.role === "admin") {
          location.href = "admin.html"; 
        } else {
          location.href = "user.html"; 
        }
      } else {
        loginErrorDisplay.textContent = "Invalid email or password!";
      }
    });

    // --- Function to Handle Forgot Password ---
    function forgotPassword() {
      const emailForReset = prompt("Enter your registered email:");
      if (!emailForReset) {
        return;   // if the user cancels or enters nothing, stop
      }

      if (emailForReset === ADMIN_EMAIL) {
        alert("Admin password reset is not allowed through this option.");
        return;
      }

      let allUsersData = JSON.parse(localStorage.getItem("users")) || [];
      let passwordWasUpdated = false; 
      
      allUsersData = allUsersData.map(user => {
        if (user.email === emailForReset) {
          const newPasswordAttempt = prompt("Enter new password (min 8 chars with letters, numbers, and special characters):");
          const passwordStrengthRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&]).{8,}$/;

          if (newPasswordAttempt && passwordStrengthRegex.test(newPasswordAttempt)) {  // match between regexp and specified string
            user.password = newPasswordAttempt; // update the password
            passwordWasUpdated = true; 
          } else {
            alert("Password too weak or empty! Please try again.");
          }
        }
        return user;
      });

      // update and save the password
      if (passwordWasUpdated) {
        localStorage.setItem("users", JSON.stringify(allUsersData));
        alert("Password updated successfully! You can now log in with your new password.");
      } else {
        alert("Email not found in our records, or new password was invalid.");
      }
    }

    // --- Function to Toggle Password Visibility ---
    function togglePassword() {
      const passwordInputField = document.getElementById("loginPassword");
      const eyeIcon = document.getElementById("toggleIcon");

      const isPasswordVisible = passwordInputField.type === "text"; // password type checking

      if (isPasswordVisible) {
        passwordInputField.type = "password";
        eyeIcon.className = "bi bi-eye-slash";
      } else {
        passwordInputField.type = "text"; 
        eyeIcon.className = "bi bi-eye"; 
      }
    }
  </script>
</body>
</html>
