<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
</head>
<body class="bg-light">
<div class="container py-5">

  <div class="d-flex justify-content-center mb-5">
    <div class="card shadow p-4 text-center border-0" style="max-width: 400px; width: 100%;">
      <h5 class="fw-semibold mb-3">Your Profile</h5>
      <p class="mb-1"><strong>Name:</strong> <span id="profileName"></span></p>
      <p class="mb-1"><strong>Email:</strong> <span id="profileEmail"></span></p>
      <p class="mb-2"><strong>User ID:</strong> <span id="profileId"></span></p>
      <span class="badge bg-primary text-uppercase">User</span>
    </div>
  </div>

  <div class="card shadow rounded-4 p-4 mb-4 border-0">
    <h5 class="fw-semibold mb-3"><i class="bi bi-people me-2"></i>All Users</h5>
    <input type="text" class="form-control mb-3" id="searchInput" placeholder="Search users...">
    <div class="table-responsive">
      <table class="table table-bordered table-striped">
        <thead class="table-primary">
          <tr>
            <th>Username</th>
            <th>Email</th>
            <th>User ID</th>
          </tr>
        </thead>
        <tbody id="userList"></tbody>
      </table>
    </div>
    <nav>
      <ul class="pagination justify-content-center" id="pagination"></ul>
    </nav>
  </div>

  <div class="text-end mt-4">
    <button onclick="logout()" class="btn btn-danger">
      <i class="bi bi-box-arrow-right me-1"></i>Logout
    </button>
  </div>
</div>

<script>
  // Get current user and all users from local storage
  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  const allUsers = JSON.parse(localStorage.getItem("users")) || [];

  // If no current user redirect to login
  if (!currentUser || currentUser.role !== "user") {
    window.location.href = "login.html";
  }

  // Display current user's information
  document.getElementById("profileName").textContent = currentUser.username;
  document.getElementById("profileEmail").textContent = currentUser.email;
  document.getElementById("profileId").textContent = currentUser.userId;

  // Pagination settings
  const rowsPerPage = 5;
  let currentPage = 1;

  // Function to render the user table and pagination
  function renderUsers() {
    const userList = document.getElementById("userList");
    const pagination = document.getElementById("pagination");
    const searchQuery = document.getElementById("searchInput").value.toLowerCase();

    const filteredUsers = allUsers.filter(user =>
      user.email !== currentUser.email && user.role !== "admin"
    ).filter(user =>
      user.username.toLowerCase().includes(searchQuery) ||
      user.email.toLowerCase().includes(searchQuery) ||
      user.userId.toLowerCase().includes(searchQuery)
    );

    // Calculate total pages for pagination
    const totalPages = Math.ceil(filteredUsers.length / rowsPerPage);

    // Get users for the current page
    const start = (currentPage - 1) * rowsPerPage;
    const end = start + rowsPerPage;
    const paginatedUsers = filteredUsers.slice(start, end);

    userList.innerHTML = "";                    // Clear previous table rows
    paginatedUsers.forEach(user => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${user.username}</td>
        <td>${user.email}</td>
        <td>${user.userId}</td>
      `;
      userList.appendChild(row);
    });

    pagination.innerHTML = "";               // Clear previous pagination links
    // Create pagination links
    for (let i = 1; i <= totalPages; i++) {
      const listItem = document.createElement("li");
      listItem.className = `page-item ${i === currentPage ? "active" : ""}`;   
      listItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
      listItem.addEventListener("click", function (e) {
        e.preventDefault();                                           // Prevent default behavior/reload
        currentPage = i;                      
        renderUsers(); 
      });
      pagination.appendChild(listItem);
    }
  }

  // Event listener for search input
  document.getElementById("searchInput").addEventListener("input", function () {
    currentPage = 1;                       // Reset page on new search
    renderUsers();                         // Render users based on new search
  });

 
  function logout() {
    localStorage.removeItem("currentUser"); 
    window.location.href = "login.html"; 
  }

  // Initial render of users when the page loads
  renderUsers();
</script>
</body>
</html>